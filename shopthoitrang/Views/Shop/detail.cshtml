@using shopthoitrang.Models
@model product
@{
    ViewBag.Title = "Sản phẩm " + Model.name_pro;
    Layout = "~/Views/Shared/_Layout.cshtml";
    database db = new database();
    var authCookie = Request.Cookies[FormsAuthentication.FormsCookieName];
    int id = -1;

    string username;
    if (authCookie != null)
    {
        var authTicket = FormsAuthentication.Decrypt(authCookie.Value);
        username = authTicket.Name;
        string userData = authTicket.UserData;
        id = int.Parse(username);
        var ten = db.User_info.Where(c => c.id_user == id).FirstOrDefault();
    }
    else
    {
        username = Session["id_user"] as string;
        int.TryParse(username,out id);
        var ten = db.User_info.Where(c => c.id_user == id).FirstOrDefault();
    }
}

<script src="~/public/js/custom.js"></script>
<!-- Shop Details Section Begin -->
<section class="shop-details">
    <div class="product__details__pic">
        <div class="container">
            <div class="row">
                <div class="col-lg-12">
                    <div class="product__details__breadcrumb">
                        <a href="~/Views/Home/Index.cshtml">Home</a>
                        <a href="~/Views/Shop/product.cshtml">Shop</a>
                        <span>Product Details</span>
                    </div>
                </div>
            </div>
            <div class="row">
                <div class="col-lg-3 col-md-3">
                    <ul class="nav nav-tabs" role="tablist">
                        @{

                            List<string> anh = Model.photo_pro.TrimEnd(',').Split(',').ToList();
                            for (int i = 0; i < anh.Count(); i++)
                            {
                                if ((i + 1) == 1)
                                {
                                    <li class="nav-item">
                                        <a class="nav-link active" data-toggle="tab" href="#tabs-@(i + 1)" role="tab">
                                            <div class="product__thumb__pic set-bg" data-setbg="/public/img/product/@anh[i]">
                                            </div>
                                        </a>
                                    </li>
                                }
                                else
                                {
                                    <li class="nav-item">
                                        <a class="nav-link" data-toggle="tab" href="#tabs-@(i + 1)" role="tab">
                                            <div class="product__thumb__pic set-bg" data-setbg="/public/img/product/@anh[i]">
                                            </div>
                                        </a>
                                    </li>
                                }
                            }
                            if (Model.video_pro != null)
                            {
                                <li class="nav-item">
                                    <a class="nav-link" data-toggle="tab" href="#tabs-99" role="tab">
                                        <div class="product__thumb__pic set-bg" data-setbg="/public/img/product/@anh[anh.Count()-1]">
                                            <i class="fa fa-play"></i>
                                        </div>
                                    </a>
                                </li>
                            }
                        }


                    </ul>
                </div>
                <div class="col-lg-6 col-md-9">
                    <div class="tab-content">
                        @{
                            for (int i = 0; i < anh.Count(); i++)
                            {
                                if (i == 0)
                                {
                                    <div class="tab-pane active" id="tabs-@(i + 1)" role="tabpanel">
                                        <div class="product__details__pic__item">
                                            <img src="~/public/img/product/@anh[i] " alt="@anh[i]">
                                        </div>
                                    </div>
                                }
                                else
                                {
                                    <div class="tab-pane" id="tabs-@(i+1)" role="tabpanel">
                                        <div class="product__details__pic__item">
                                            <img src="~/public/img/product/@anh[i] " alt="@anh[i]">
                                        </div>
                                    </div>
                                }
                            }
                            if (Model.video_pro != null)
                            {
                                <div class="tab-pane" id="tabs-99" role="tabpanel">
                                    <div class="product__details__pic__item">
                                        <video controls>
                                            <source src="~/public/img/product/video/@Model.video_pro" type="video/mp4">

                                        </video>
                                    </div>
                                </div>
                            }
                        }
                       

                    </div>

                </div>
            </div>
        </div>
    </div>
    <div class="product__details__content">
        <div class="container">
            <div class="row d-flex justify-content-center">
                <div class="col-lg-8">
                    <div class="product__details__text">
                        <h4>@Model.name_pro</h4>
                        <div class="rating">
                            @{

                                var danhgia = db.rate.Where(r => r.id_product == Model.id_product).Select(r => r.star_rate).ToList();
                                int rate = 0, demso = 0;
                                if (danhgia.Count > 0)
                                {
                                    foreach (var dem in danhgia)
                                    {
                                        demso += dem ?? 0;
                                    }
                                    rate = demso / danhgia.Count;
                                }
                                for (int i = 0; i < rate; i++)
                                {
                                    <i class="fa fa-star"></i>
                                }
                                for (int i = 0; i < 5 - rate; i++)
                                {
                                    <i class="fa fa-star-o"></i>
                                }
                                <span> - @danhgia.Count Reviews</span>
                            }

                        </div>
                        @{
                            var tien = Model.price_pro - (Model.price_pro * Model.discount_pro / 100);
                            string gia = string.Format("{0:#,##0}₫", tien);
                        }
                        <h3>@gia<span>@Model.price_pro đ</span></h3>
                        <p>
                            @Model.info_pro
                        </p>
                        <hr />
                        <form id="myform">
                            <div class="product__details__option">
                                <div class="product__details__option__size">
                                    <input name="id_pro" value="@Model.id_product" hidden />
                                    <span>Size:</span>
                                    @{
                                        var size = db.product.Where(p => p.id_product == Model.id_product).Select(c => c.size_pro).FirstOrDefault();
                                        var mang = size.Split(',').Select(c => c.Trim()).ToList();
                                        foreach (var item in mang)
                                        {
                                            <label for="@item">
                                                @item
                                                <input type="radio" id="@item" value="@item" name="size">
                                            </label>
                                        }
                                    }

                                    <div class="shop__product__option__right">
                                        <span>Color :</span>
                                        <select name="color">
                                            @{
                                                var color = db.product.Where(c => c.id_product == Model.id_product).Select(c => c.color_pro).FirstOrDefault();
                                                if (color != null)
                                                {
                                                    var list = color.Split(',').Select(c => c.Trim()).ToList();
                                                    foreach (var item in list)
                                                    {
                                                        <option value="@item">@item</option>
                                                    }
                                                }
                                            }
                                        </select>
                                    </div>
                                </div>


                            </div>
                            <div class="product__details__cart__option">
                                <div class="quantity">
                                    <div class="pro-qty">
                                        <input type="text" value="1" name="quantity">
                                    </div>
                                </div>

                                <a href="javascript:void(0)" onclick="themgiohang()" class="primary-btn">add to cart</a>
                            </div>
                        </form>
                        <div class="product__details__btns__option">
                            @{
                                bool che = false;
                                if (id != -1)
                                {
                                    var check = db.User_info.Where(p => p.id_user == id).Select(c => c.favourite_pro).FirstOrDefault();
                                    if (check != null)
                                    {
                                        var data = check.Split(',').ToList();
                                        string idpro = Model.id_product.ToString();

                                        foreach (var yt in data)
                                        {

                                            if (yt == idpro)
                                            {
                                                che = true;
                                            }
                                        }
                                    }
                                }
                                if (che)
                                {
                                    <a id="tomau" href="javascript:void(0)" onclick="them('@Model.id_product')" style="color:palevioletred"><i class="fa fa-heart"></i> add to wishlist</a>
                                }
                                else
                                {
                                    <a id="tomau" href="javascript:void(0)" onclick="them('@Model.id_product')"><i class="fa fa-heart"></i> add to wishlist</a>
                                }


                            }

                        </div>
                        <div class="product__details__last__option">
                            <h5><span>Guaranteed Safe Checkout</span></h5>
                            <img src="img/shop-details/details-payment.png" alt="">
                            <ul>
                                <li><span>SKU:</span> @Model.id_product</li>
                                @{
                                    var type_pro = db.product_type.Where(c => c.id_protype == Model.id_protype).FirstOrDefault();
                                    var cate = db.Category.Where(c => c.id_cate == type_pro.id_cate).FirstOrDefault();
                                }
                                <li><span>Categories:</span> @cate.name_cate</li>
                                <li><span>Tag:</span>@Model.tag</li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
            <div class="row">
                <div class="col-lg-12">
                    <div class="product__details__tab">
                        <ul class="nav nav-tabs" role="tablist">
                            <li class="nav-item">
                                <a class="nav-link active" data-toggle="tab" href="#tabs-5"
                                   role="tab">Description</a>
                            </li>
                            <li class="nav-item">
                                <a class="nav-link" data-toggle="tab" href="#tabs-6" role="tab">
                                    Customer
                                    Previews(@danhgia.Count)
                                </a>
                            </li>

                        </ul>
                        <div class="tab-content">
                            <div class="tab-pane active" id="tabs-5" role="tabpanel">
                                <div class="product__details__tab__content">
                                    <p class="note">
                                        @Model.info_pro
                                    </p>

                                </div>
                            </div>
                            <div class="tab-pane" id="tabs-6" role="tabpanel">
                                <div class="product__details__tab__content">
                                    <section class="product_description_area">
                                        <div class="container">

                                            <div class="tab-content" id="myTabContent">

                                                <div class="tab-pane fade show active" id="review" role="tabpanel" aria-labelledby="review-tab">
                                                    <div class="row">
                                                        <div class="col-lg-6">
                                                            <div class="row total_rate">
                                                                <div class="col-6">
                                                                    <div class="box_total">
                                                                        <h5>Overall</h5>
                                                                        <h4>@rate</h4>
                                                                        <h6>(@danhgia.Count Reviews)</h6>
                                                                    </div>
                                                                </div>
                                                                <div class="col-6">
                                                                    <div class="rating_list">
                                                                        <h3>Based on @danhgia.Count Reviews</h3>
                                                                        <ul class="list">
                                                                            @{
                                                                                int sao5 = db.rate.Where(p => p.id_product == Model.id_product && p.star_rate == 5).Select(c => c.star_rate).Count();
                                                                                int sao4 = db.rate.Where(p => p.id_product == Model.id_product && p.star_rate == 4).Select(c => c.star_rate).Count();
                                                                                int sao3 = db.rate.Where(p => p.id_product == Model.id_product && p.star_rate == 3).Select(c => c.star_rate).Count();
                                                                                int sao2 = db.rate.Where(p => p.id_product == Model.id_product && p.star_rate == 2).Select(c => c.star_rate).Count();
                                                                                int sao1 = db.rate.Where(p => p.id_product == Model.id_product && p.star_rate == 1).Select(c => c.star_rate).Count();
                                                                            }
                                                                            <li>
                                                                                <a href="#">
                                                                                    5 Star
                                                                                    <i class="fa fa-star"></i>
                                                                                    <i class="fa fa-star"></i>
                                                                                    <i class="fa fa-star"></i>
                                                                                    <i class="fa fa-star"></i>
                                                                                    <i class="fa fa-star"></i> @sao5
                                                                                </a>
                                                                            </li>
                                                                            <li>
                                                                                <a href="#">
                                                                                    4 Star
                                                                                    <i class="fa fa-star"></i>
                                                                                    <i class="fa fa-star"></i>
                                                                                    <i class="fa fa-star"></i>
                                                                                    <i class="fa fa-star"></i>
                                                                                    <i class="fa fa-star"></i> @sao4
                                                                                </a>
                                                                            </li>
                                                                            <li>
                                                                                <a href="#">
                                                                                    3 Star
                                                                                    <i class="fa fa-star"></i>
                                                                                    <i class="fa fa-star"></i>
                                                                                    <i class="fa fa-star"></i>
                                                                                    <i class="fa fa-star"></i>
                                                                                    <i class="fa fa-star"></i> @sao3
                                                                                </a>
                                                                            </li>
                                                                            <li>
                                                                                <a href="#">
                                                                                    2 Star
                                                                                    <i class="fa fa-star"></i>
                                                                                    <i class="fa fa-star"></i>
                                                                                    <i class="fa fa-star"></i>
                                                                                    <i class="fa fa-star"></i>
                                                                                    <i class="fa fa-star"></i> @sao2
                                                                                </a>
                                                                            </li>
                                                                            <li>
                                                                                <a href="#">
                                                                                    1 Star
                                                                                    <i class="fa fa-star"></i>
                                                                                    <i class="fa fa-star"></i>
                                                                                    <i class="fa fa-star"></i>
                                                                                    <i class="fa fa-star"></i>
                                                                                    <i class="fa fa-star"></i> @sao1
                                                                                </a>
                                                                            </li>
                                                                        </ul>
                                                                    </div>
                                                                </div>
                                                            </div>
                                                            <div class="review_list">
                                                                @{

                                                                    var danhgia_ng_dung = db.rate.Where(r => r.id_product == Model.id_product).ToList();
                                                                    foreach (var item in danhgia_ng_dung)
                                                                    {
                                                                        var ten = db.comment.Where(c => c.id_comment == item.id_comment).FirstOrDefault();

                                                                        if (ten != null)
                                                                        {
                                                                            var tenng = db.User_info.Where(c => c.id_user == ten.id_user).FirstOrDefault();

                                                                            <div class="review_item">
                                                                                <div class="media">
                                                                                    <div class="">
                                                                                        <img style="height:70px ;border-radius:50%; margin-right:10px" src="~/public/img/user/@tenng.img" alt="" />
                                                                                    </div>
                                                                                    <div class="media-body">
                                                                                        <h4>@tenng.name</h4>
                                                                                        @for (int i = 0; i < item.star_rate; i++)
                                                                                        {
                                                                                            <i class="fa fa-star"></i>
                                                                                        }
                                                                                        @for (int i = 0; i < 5 - item.star_rate; i++)
                                                                                        {
                                                                                            <i class="fa fa-star-o"></i>
                                                                                        }
                                                                                    </div>
                                                                                </div>

                                                                                <p>

                                                                                    @ten.comment1
                                                                                </p>

                                                                            </div>
                                                                        }
                                                                    }
                                                                }


                                                            </div>
                                                        </div>
                                                        <div class="col-lg-6">


                                                            @{
                                                                if (id != -1)
                                                                {
                                                                    <div class="review_box">
                                                                        <h4>Add a Review</h4>
                                                                        <form class="row contact_form" action="" method="post" novalidate="novalidate">
                                                                            <h6>Your Rating:</h6>
                                                                            <input value="@Model.id_product" name="id_pro" hidden />
                                                                            <input value="@id" name="id_user" hidden />
                                                                            <div class="rating">
                                                                                <input value="5" name="rating" id="star5" type="radio">
                                                                                <label for="star5"></label>
                                                                                <input value="4" name="rating" id="star4" type="radio">
                                                                                <label for="star4"></label>
                                                                                <input value="3" name="rating" id="star3" type="radio">
                                                                                <label for="star3"></label>
                                                                                <input value="2" name="rating" id="star2" type="radio">
                                                                                <label for="star2"></label>
                                                                                <input value="1" name="rating" id="star1" type="radio">
                                                                                <label for="star1"></label>
                                                                            </div>

                                                                            <div class="col-md-12 form-group">
                                                                                <div class="group">
                                                                                    <textarea required="" name="comment" type="text" class="input"></textarea>
                                                                                    <span class="highlight"></span>
                                                                                    <span class="bar"></span>
                                                                                    <label>comment</label>
                                                                                </div>
                                                                            </div>

                                                                            <div class="col-md-12 text-right">
                                                                                <button type="submit" value="submit" class="button">

                                                                                    <p class="text">Submit Now</p>

                                                                                </button>
                                                                            </div>
                                                                        </form>
                                                                    </div>
                                                                }
                                                                else
                                                                {
                                                                    <a class="btn btn-primary" href="@Url.Action("Login","Home")">

                                                                        <p class="text">Đăng nhập</p>

                                                                    </a>
                                                                }
                                                            }

                                                        </div>

                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </section>
                                </div>
                            </div>

                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>
<!-- Shop Details Section End -->
<!-- Related Section Begin -->
<section class="related spad">
    <div class="container">
        <div class="row">
            <div class="col-lg-12">
                <h3 class="related-title">Related Product</h3>
            </div>
        </div>
        <div class="row">
            
            @{
                var datasp = db.product.Where(c => c.id_protype == Model.id_protype).Take(6).ToList();
                foreach (var item in datasp)
                {
                    var giatien = item.price_pro - (item.price_pro * item.discount_pro / 100);
                    string gia_sp = string.Format("{0:#,##0}₫", giatien);

                    var SinceUpdate = (DateTime.Now - DateTime.Parse(item.date_update)).Days;
                    string idsp = "sp" + item.id_product;
                    var danhgiarate = db.rate.Where(r => r.id_product == item.id_product).Select(r => r.star_rate).ToList();
                    int ratesp = 0, demsosp = 0;

                    bool yeeuthich = false;
                    if (id != -1)
                    {
                        var check = db.User_info.Where(p => p.id_user == id).Select(c => c.favourite_pro).FirstOrDefault();
                        if (check != null)
                        {
                            var data_yt = check.Split(',').ToList();
                            string idpro = item.id_product.ToString();

                            foreach (var yt in data_yt)
                            {

                                if (yt == idpro)
                                {
                                    yeeuthich = true;
                                }
                            }
                        }
                    }

                    if (danhgiarate.Count > 0)
                    {
                        foreach (var dem in danhgiarate)
                        {
                            demso += dem ?? 0;
                        }
                        ratesp = demsosp / danhgiarate.Count;
                    }
                    if (SinceUpdate < 3)
                    {
                        <div class="col-lg-3 col-md-6 col-sm-6 col-sm-6">
                            <div class="product__item sale">
                                <div class="product__item__pic">
                                    <a class="product__item__pic " href="@Url.Action("detail","Shop", new { id_pro=item.id_product})">
                                        <img class=" product__item__pic set-bg"  data-setbg="~/public/img/product/@item.photo_pro" />
                                    </a>
                                    <span class="label">Sale</span>
                                    <ul class="product__hover">
                                        <li>
                                            <a href="javascript:void(0)" onclick="yeu('@idsp','@item.id_product','@Url.Action("favourite","Shop")')">
                                                @{ if (yeeuthich)
                                                    {
                                                        <img id="@idsp" src="/public/img/icon/heart_red.png" alt="">
                                                    }
                                                    else
                                                    {

                                                        <img id="@idsp" src="/public/img/icon/heart.png" alt="">
                                                    }
                                                }
                                            </a>
                                        </li>
                                    </ul>
                                </div>
                                <div class="product__item__text">
                                    <h6>@item.name_pro</h6>
                                    <a href="@Url.Action("detail","Shop", new { id_pro=item.id_product})" class="add-cart">+ View more</a>
                                    <div class="rating">
                                        @{
                                            for (int i = 0; i < rate; i++)
                                            {
                                                <i class="fa fa-star"></i>
                                            }
                                            for (int i = 0; i < 5 - rate; i++)
                                            {
                                                <i class="fa fa-star-o"></i>
                                            }
                                        }

                                    </div>

                                    <h5>@gia</h5>
                                    <span>lượt mua: @item.buy_count</span>

                                </div>
                            </div>
                        </div>
                    }
                    else if (item.discount_pro > 10)
                    {
                        <div class="col-lg-3 col-md-6 col-sm-6 col-sm-6">

                            <div class="product__item sale">

                                <div class="product__item__pic">
                                    <a class="product__item__pic " href="@Url.Action("detail","Shop", new { id_pro=item.id_product})">
                                        <img class=" product__item__pic set-bg" src="~/public/img/product/@item.photo_pro" />
                                    </a>
                                    <span class="label">Sale</span>
                                    <ul class="product__hover">
                                        <li>
                                            <a href="javascript:void(0)" onclick="yeu('@idsp','@item.id_product','@Url.Action("favourite","Shop")')">
                                                @{ if (yeeuthich)
                                                    {
                                                        <img id="@idsp" src="/public/img/icon/heart_red.png" alt="">
                                                    }
                                                    else
                                                    {

                                                        <img id="@idsp" src="/public/img/icon/heart.png" alt="">
                                                    }
                                                }
                                            </a>
                                        </li>
                                    </ul>
                                </div>

                                <div class="product__item__text">
                                    <h6>@item.name_pro</h6>

                                    <a href="@Url.Action("detail","Shop", new { id_pro=item.id_product})" class="add-cart">+ View more</a>
                                    <div class="rating">
                                        @{
                                            for (int i = 0; i < rate; i++)
                                            {
                                                <i class="fa fa-star"></i>
                                            }
                                            for (int i = 0; i < 5 - rate; i++)
                                            {
                                                <i class="fa fa-star-o"></i>
                                            }
                                        }
                                    </div>

                                    <h5>@gia</h5>
                                    <span>lượt mua: @item.buy_count</span>

                                </div>

                            </div>

                        </div>

                    }
                    else
                    {
                        <div class="col-lg-3 col-md-6 col-sm-6 col-sm-6">
                            <a href="#">
                                <div class="product__item sale">

                                    <div class="product__item__pic">
                                        <a class="product__item__pic " href="@Url.Action("detail","Shop", new { id_pro=item.id_product})">
                                            <img class=" product__item__pic set-bg" src="~/public/img/product/@item.photo_pro" />
                                        </a>
                                        <span class="label">Sale</span>
                                        <ul class="product__hover">
                                            <li>
                                                <a href="javascript:void(0)" onclick="yeu('@idsp','@item.id_product','@Url.Action("favourite","Shop")')">
                                                    @{ if (yeeuthich)
                                                        {
                                                            <img id="@idsp" src="/public/img/icon/heart_red.png" alt="">
                                                        }
                                                        else
                                                        {

                                                            <img id="@idsp" src="/public/img/icon/heart.png" alt="">
                                                        }
                                                    }
                                                </a>
                                            </li>
                                        </ul>
                                    </div>

                                    <div class="product__item__text">
                                        <h6>@item.name_pro</h6>
                                        <a href="@Url.Action("detail","Shop", new { id_pro=item.id_product})" class="add-cart">+ View more</a>
                                        <div class="rating">
                                            @{
                                                for (int i = 0; i < rate; i++)
                                                {
                                                    <i class="fa fa-star"></i>
                                                }
                                                for (int i = 0; i < 5 - rate; i++)
                                                {
                                                    <i class="fa fa-star-o"></i>
                                                }
                                            }
                                        </div>
                                        <h5>@gia</h5>
                                        <span>lượt mua: @item.buy_count</span>

                                    </div>

                                </div>
                            </a>
                        </div>
                    }
                }
            }

        </div>
    </div>
</section>

<div id="notification" class="notifications-container" style="display:none">
    <div class="success">
        <div class="flex">
            <div class="flex-shrink-0">

                <svg class="succes-svg" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" aria-hidden="true">
                    <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"></path>
                </svg>
            </div>
            <div class="success-prompt-wrap">
                <p class="success-prompt-heading">
                    Thành công !!
                </p><div class="success-prompt-prompt">
                    <p>Đã được cập nhập</p>
                </div>
                
            </div>
        </div>
    </div>
</div>

<!-- Related Section End -->

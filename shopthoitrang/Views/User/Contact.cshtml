
@{
    ViewBag.Title = "Contact";
    Layout = "~/Views/Shared/_Layout.cshtml";
}
<link rel="stylesheet" href="~/public/css/all.min.css">
<script src="~/public/js/scripts.js"></script>
<script src="~/public/js/stisla.js"></script>
<link rel="stylesheet" href="~/public/css/components.css">
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-94034622-3"></script>

  
            <div class="row align-items-center justify-content-center">

                <div class="col-1 col-sm-5 col-lg-5">
                    <div class="chat-box" id="mychatbox">
                        <div class="card-header">
                            <h4>Chat with Admin</h4>
                        </div>
                        <div class="card-body chat-content nice-scroll"style="height: 600px;" id="message">
                            
                        </div>
                        <div class="card-footer chat-form">
                            <div id="chat-form">
                                <input type="text" id="input_message" value="" onkeydown="handleKeyDown(event)" class="form-control" placeholder="Type a message">
                                <a onclick="post_chat('@Url.Action("post_chat","User")')" class="btn btn-primary">
                                    <i class="fa fa-paper-plane"></i>
                                </a>
                            </div>
                        </div>
                    </div>
                </div>

            </div>
       

            <script>
                function handleKeyDown(event) {
                    if (event.key === 'Enter') {
                        post_chat('@Url.Action("post_chat","User")');
                    }
                }
               
                function post_chat(url) {
                    var form = document.getElementById('input_message');
                    $.ajax({
                        url: url,
                        type: 'POST',
                        data: { message: form.value },
                        success: function (res) {
                            if (res.result == true) {
                                console.log("thành công");
                                form.value = "";
                                $.ajax({
                                    url: '/User/message',
                                    method: 'GET',
                                    success: function (response) {
                                        $('#message').html(response);
                                        
                                    },
                                    error: function (xhr, status, error) {
                                        // Xử lý lỗi
                                        console.error(error);
                                    },
                                })
                            } 
                        },
                    });
                }
                setInterval(function () {

                    $.ajax({
                        url: '/User/message',
                        method: 'GET',
                        success: function (response) {
                            $('#message').html(response);
                        },
                        error: function (xhr, status, error) {
                            // Xử lý lỗi
                            console.error(error);
                        },
                    })

                }, 2000);
                
                var scrollableDiv = document.getElementById('message');

                var prevHeight = scrollableDiv.scrollHeight;

                setInterval(function () {

                    if (scrollableDiv.scrollHeight !== prevHeight) {

                        prevHeight = scrollableDiv.scrollHeight;

                        scrollableDiv.scrollTop = scrollableDiv.scrollHeight;
                    }
                }, 500);
            </script>
            